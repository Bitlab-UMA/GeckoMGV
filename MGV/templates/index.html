{%extends "includes/basic.html"%}
{%load staticfiles%}
{%block content%}

	<div id="main" class="container center-block" role="main">

		<div class="row row-centered">
			<div class="col-xs-12 col-sm-12 col-md-12 col-lg-7">
				<div class="row row-centered my-container2">
					<div>
						<div id="fileName">
							Upload a fragments file
							<button id="infoPopover" type="button"
								class="btn btn-warning btn-xs btn-padding" data-container="body"
								data-toggle="popover" data-placement="right"
								data-content="Not file loaded" data-html="true">?</button>
						</div>
					</div>

					<!-- ---------- CANVAS -------------------- -->
					<div id="canvasContainer" class="canvas-centered">
						<canvas id="myCanvasGrid" class="img-responsive" width="600" height="550"></canvas>
						<canvas id="myCanvas" class="img-responsive"  width="500" height="500"></canvas>
						<canvas id="myCanvasLayer1" class="img-responsive"  width="500" height="500"> </canvas>
                        <canvas id="myCanvasLayer2" class="img-responsive"  width="500" height="500"> </canvas>
					</div>
				</div>

				<div class="row row-centered my-container2">
					<div class="col-md-10 col-centered">
						<div class="div-centered">
							<div id="fileNameMAT">
								Upload a Matrix file
								<button id="infoPopoverMatriz" type="button"
									class="btn btn-warning btn-xs btn-padding"
									data-container="body" data-toggle="popover"
									data-placement="right" data-content="Not file loaded"
									data-html="true">?</button>
							</div>
						</div>

						<!-- ---------- CANVAS Matrix -------------------- -->
                        <div class="tab-content">
                            <div id="canvasContainerMatrix" class="div-centered tab-pane fade in active">
                                <canvas id="myCanvasMatrix" class="img-responsive" width="500" height="100"> </canvas>
                            </div>
                        </div>

                        <ul class="nav nav-pills nav-justified">
                            <li class="active"><a data-toggle="tab" href="#canvasContainerMatrix">Matrix</a></li>
                            <li><a data-toggle="tab" href="#menu1">Sequence</a></li>
                        </ul>

					</div>
				</div>

			</div>

			<div class="col-md-4">
				<div class="row row-centered">
					<div class="col-xs-9 col-sm-9 col-centered">
						<div class="panel panel-primary">
							<div class="panel-heading">
                                <a data-toggle="collapse" data-target="#MapColapsed" href="#MapColapsed" class="collapse-link panel-title accordion-toggle">Map</a>
							</div>
                            <div id="MapColapsed" class="panel-collapse collapse in">
                                <div class="panel-body ">
                                        <div id="canvasMapContainer" class="div-centered row-centered top-buffer">
                                            <img id="mapimage" width="202" height="202"/>
                                            <canvas id="myMap" width="200" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
						</div>
					</div>
				</div>
				<div class="row row-centered">
					<div class="col-xs-9 col-sm-9 col-centered">
						<div class="panel panel-primary">
							<div class="panel-heading">
                                <a data-toggle="collapse" data-target="#FunctionsColapsed" href="#FunctionsColapsed" class="collapse-link panel-title accordion-toggle">Functions</a>
							</div>
                            <div id="FunctionsColapsed" class="panel-collapse collapse in">
                                <div class="panel-body">
								<div class="row row-centered top-buffer">
									<span class="btn btn-primary btn-file"> Load frags <input
										type="file" multiple="true"
										onchange="handleFiles(this.files,'csv')" accept=".csv">
									</span>
									<span class="btn btn-primary btn-file"> Load MAT <input
										type="file" onchange="handleFiles(this.files,'mat')"
										accept=".MAT">
									</span>
								</div>
                                <div class="row row-centered top-buffer">
									<span class="btn btn-primary btn-file">Load Mauve<input type="file" multiple="true" onchange="handleFiles(this.files,'mvn')" accept=".txt"></span>
								</div>
								<div class="row row-centered top-buffer">
									<select id="viewSelect">
										<option selected disabled>Choose view</option>
										<option>Traditional</option>
										<option>Horizontal</option>
									</select>
								</div>
								<div class="row row-centered top-buffer">
									<div class="btn-group btn-group-justified btn-padding">
										<div class="btn-group">
											<button type="button" class="btn btn-default"
												onclick="resetDraw()">Initial View</button>
										</div>
										<div class="btn-group">
											<button type="button" class="btn btn-default"
												onclick="activateBoard()">Grid</button>
										</div>
									</div>
								</div>
								<div class="row row-centered top-buffer btn-group">
									<div class="btn-group btn-group-justified btn-padding">
										<div class="btn-group">
											<!--<button type ="button" class="btn btn-default" onclick="showDivInfoInPopup('output', 'popuptable.html', 'PopupTable')">CSB & Frag info</button> -->
											<!--<button class="btn btn-default" data-toggle="modal" data-target="#infoModal" data-backdrop="false">CSB & Frag info</button>-->
											<button type="button" class="btn btn-default" onclick="dialogFrags()">CSB
												& Frag info</button>

										</div>
										<div class="btn-group">
											<!--<button type ="button" class="btn btn-default" onclick="showDivInfoInPopup('annotationsOutput', 'annotationstable.html', 'Annotations Table')">Annotations</button>-->
											<button class="btn btn-default" onclick="dialogAnnotations()">Annotations</button>
										</div>
									</div>
								</div>

								<div class="row top-buffer btn-padding form-group row-centered">
									<form name="option" class="form-centered">
										<input type="radio" name="tipo" value="Frag" checked
											onClick="redraw()"><span class="formType">HSP</span>
										<input type="radio" name="tipo" value="CSB" onClick="redraw()"><span
											class="formType">CSB</span> <input type="radio" name="tipo"
											value="all" onClick="redraw()"><span class="formType">HSP
											& CSB</span>
									</form>
								</div>

							</div>
                            </div>
						</div>
					</div>
				</div>
				<div class="row row-centered">
					<div class="col-xs-9 col-sm-9 col-centered">
						<div class="panel panel-primary">
							<div class="panel-heading">
                                <a data-toggle="collapse" data-target="#FiltersColapsed" href="#FiltersColapsed" class="collapse-link panel-title accordion-toggle">Filters</a>
							</div>
                            <div id="FiltersColapsed" class="panel-collapse collapse in">
							<div class="panel-body">
								<div class="row top-buffer btn-padding">
									<form name="filters" id="filters">
										<div class="checkbox">
											<label> <input type="checkbox" id="filterIrrelevants"
												value="irrelevants" onClick="redraw()">Statistical
												Significance
											</label>
										</div>
										<div class="checkbox">
											<label> <input type="checkbox" id="filterOverlapped"
												value="overlapped" onClick="redraw()">Overlapped
												(Repetitions)
											</label>
										</div>
										<div class="checkbox">
											<label> <input type="checkbox" id="filterOverlapped2"
												value="overlapped2" onClick="redraw()">Duplications
											</label>
										</div>
										<div class="checkbox">
											<label> <input type="checkbox" id="filterPositives"
												value="positives" onClick="redraw()">Positive blocks
											</label>
										</div>
										<div class="input-group group-padding">
											<span class="input-group-addon"> <input
												type="checkbox" id="filterLenght" value="lenght"
												onClick="redraw()">MinLength<br>
											</span> <input type="number" class="form-control"
												id="filterLenghtNumber" value="200">
										</div>
										<div class="input-group group-padding">
											<span class="input-group-addon"> <input
												type="checkbox" id="filterSimilarity" value="similarity"
												onClick="redraw()">MinSimilarity<br>
											</span> <input type="number" class="form-control"
												id="filterSimilarityNumber" value="50" min="0" max="100">
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
                <div class="row row-centered">
					<div class="col-xs-9 col-sm-9 col-centered">
						<div class="panel panel-primary">
							<div class="panel-heading">
                                <a data-toggle="collapse" data-target="#AnnotColapsed" href="#AnnotColapsed" class="collapse-link panel-title accordion-toggle">Annotations</a>
							</div>
                            <div id="AnnotColapsed" class="panel-collapse collapse in">
							<div class="panel-body">
								<div class="row top-buffer btn-padding">
                                    <div id="Annotations">
                                        <div class="SearchTitleFilterButton">
                                            <span>Search:</span>
                                            <input type="text" class="SearchFilter2" />
                                            <button class="SearchButton" onclick="showResults($('.SearchFilter2').val(),true)"><span class="glyphicon glyphicon-search"></span></button>
                                        </div>
                                    </div>
                                </div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

    <!--Dialog for CSB & Frag Info -->
    <div id="output" class="ui-helper-hidden"><div class="SearchTitle" >
<div class="SearchTitleFilterButton">
<span>Filter:</span>
<input type="text" class="SearchFilter" />
<button class="SearchButton" ><span class="glyphicon glyphicon-search"></span></button>
</div>
</div>
</div>

    <!--Dialog for Annotations -->
    <div id="annotationsOutput" class="ui-helper-hidden"></div>

    <!-- Popover to show CSB Info in Canvas -->
	<div class="popover right" id="CSBPopover" role="tooltip"></div>


	<script>
		//InfoPopover = File info popover.
		$(function() {
			$("#infoPopover").popover();
		});

		//Erase localStorage when close
		$(window).unload(function() {
			localStorage.clear()
		});

		//Detect changes on filterLength value
		$("#filterLenghtNumber").change(function() {
			if (document.getElementById("filterLenght").checked) {
				redraw();
			}
		});

		$("#filterSimilarityNumber").change(function() {
			if (document.getElementById("filterLenght").checked) {
				redraw();
			}
		});

		//Not sending form on ENTER
		$("#filters").submit(function() {
			return false;
		});

		//Detecting keyEvent on form
		$("#filterLenghtNumber").keyup(function(e) {
			if (e.keyCode == 13) {
				redraw();
			}
		});

		$("#filterSimilarityNumber")
				.keyup(
						function(e) {
							if (e.keyCode == 13) {
								if (document
										.getElementById("filterSimilarityNumber").value > 100) {
									document
											.getElementById("filterSimilarityNumber").value = 100;
								} else if (document
										.getElementById("filterSimilarityNumber").value < 0) {
									document
											.getElementById("filterSimilarityNumber").value = 0;
								}
								redraw();
							}
						});
	</script>

{% endblock %}
